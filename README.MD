# Discord store bot

Uma aplica√ß√£o que age como uma loja virtual com poucos produtos no aplicativo Discord, contando com cria√ß√£o de canais de tickets, integra√ß√£o de pagamento autom√°tico, escolha de produtos atrav√©s de uma lista em formato de menu dropdown, al√©m de um servidor Flask para que seja poss√≠vel definir um webhook que ser√° acionado pela plataforma [Stripe](https://stripe.com/br) para checar a situa√ß√£o da transa√ß√£o.

## √çndice

- [Tecnologias](#tecnologias)
- [Stripe](#stripe)
- [Instala√ß√£o](#instala√ß√£o)
- [Utiliza√ß√£o](#utiliza√ß√£o)
- [Considera√ß√µes Finais](#considera√ß√µesfinais)

## Tecnologias

- Python 3.x
- Flask
- Discord.py
- SQLite
- Stripe API

## Stripe

Para que a aplica√ß√£o seja funcional, uma API Key provida pela plataforma [Stripe](https://stripe.com/br) ser√° necess√°ria. Essa plataforma cuidar√° do checkout dos produtos da nossa loja. Ap√≥s a cria√ß√£o de conta, acesse a [dashboard](https://dashboard.stripe.com) da plataforma e crie um novo [WebHook](https://dashboard.stripe.com/test/workbench/webhooks). Nesse WebHook, selecione seu dom√≠nio com a rota "/webhook", exemplo:

```
https://d9d6-2804-bd8-738f-aa01-5803-5e9c-daea-f975.ngrok-free.app/webhook
```

Certifique-se de marcar o evento ```checkout.session.completed```. Ao mesmo tempo, verifique a chave de seguran√ßa do webhook, tamb√©m fornecido pela plataforma, voc√™ pode encontrar algo como "Segredo da assinatura" na dashboard, nas informa√ß√µes do seu webhook, adicione-o ao arquivo .env da nossa aplica√ß√£o.

A Stripe necessita ter acesso a este endere√ßo para que ela envie uma requisi√ß√£o POST com os dados do checkout ap√≥s o usu√°rio efetuar o pagamento, ent√£o, este endere√ßo n√£o pode ser local, deve obrigat√≥riamente estar exposto para a internet. Caso queira testar em ambiente de desenvolvimento, recomendo utilizar o Ngrok para expor seu endere√ßo na internet (por padr√£o, a porta aberta √© 4242, ent√£o, localhost:4242).

![Secret](images/webhook_secret.png)

## Instala√ß√£o

Instale o Python em sua vers√£o mais recente, certifique-se de marcar as op√ß√µes que o fa√ßam ser adicionados ao PATH e que o "pip" seja instalado.
1. Clone o reposit√≥rio:

    ```bash
    git clone https://github.com/httpsotavio/discordStoreBot.git
    ```

2. Instale as depend√™ncias necess√°rias

    ```python
    pip -r requirements.txt
    ```

3. Abra o arquivo .env e preencha com suas chaves de API, obtidas atrav√©s da plataforma Stripe e Discord Developer Portal.

4. Em um terminal, navegue at√© a pasta server, e execute o seguinte comando

    ```python
    py stripePayment.py
    ```

5. Em um novo terminal, na pasta raiz do projeto, execute o seguinte comando para subir o bot ao ar

    ```python
    py bot.py
    ```

Se tudo ocorrer bem, j√° √© pra voc√™ ter um bot funcional no ar!

## Utiliza√ß√£o

Voc√™ dever√° definir uma categoria no arquivo `donateViews.py`, no diret√≥rio `utils/views`, na linha 84, por padr√£o, a categoria √© `"üõí| Carrinho"`, esta categoria precisa existir no seu servidor do Discord para que os canais de tickets sejam criados dentro dela.

![Carrinho](images/carrinho.png)

Em um canal avulso, execute o comando `/aimcolor`, sua mensagem ser√° deletada e o bot enviar√° uma mensagem com um menu dropdown, onde tudo dever√° correr em um fluxo a partir dai.

![Aimcolor](images/aimcolor.png)

Logo ap√≥s, o canal de ticket poder√° ser acessado pelo usu√°rio que o solicitou, aparentando da seguinte forma:

![Ticket](images/ticket.png)

Ap√≥s isso, tudo seguir√° um fluxo padr√£o, como voc√™ pode ver no v√≠deo abaixo.

![Demo](demo.mp4)

## Considera√ß√µes finais

O servidor em Flask puramente n√£o √© recomendado para ser usado em produ√ß√£o, recomendo o uso de gunicorn, para que algo robusto seja criado.